<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ó–∞—è–≤–æ–∫ - –ù–æ–≤–∞—è –ó–∞—è–≤–∫–∞</title>
    <style>
      /* :root definition is no longer strictly needed for these colors,
         but kept here for clarity on the original design intent or potential future use.
         The actual styling now uses Telegram variables with fallbacks. */
      :root {
        --original-primary-color: #2481d7;
        --original-secondary-color: #e5e5ea;
        --original-text-color: #1a1a1a;
        --original-label-color: #666;
        --original-background-color: #f0f2f5;
        --original-white: #ffffff;
        --original-border-color: #ddd;
        --original-destructive-color: red;
        /* Alpha version of button color for box-shadow, adjust as needed or use a fixed rgba */
        --tg-theme-button-color-alpha: rgba(36, 129, 215, 0.2); 
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        /* Use Telegram background and text colors with fallbacks */
        background-color: var(--tg-theme-bg-color, var(--original-background-color));
        color: var(--tg-theme-text-color, var(--original-text-color));
        margin: 0;
        padding: 20px;
        display: flex;
        justify-content: center;
        /* Ensure safe area insets are handled on iOS */
        padding-top: calc(env(safe-area-inset-top, 0px) + 20px);
        padding-left: calc(env(safe-area-inset-left, 0px) + 20px);
        padding-right: calc(env(safe-area-inset-right, 0px) + 20px);
        padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 20px);
        box-sizing: border-box; /* Include padding in height/width */
        min-height: 100vh; /* Ensure body takes full viewport height */
      }

      .ticket-container {
        /* Use Telegram secondary background color for the container */
        background: var(--tg-theme-secondary-bg-color, var(--original-white));
        border-radius: 12px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1); /* Keep shadow subtle */
        padding: 20px;
        width: 100%;
        max-width: 400px;
        box-sizing: border-box;
      }

      .header {
        font-size: 20px;
        font-weight: 500;
        margin-bottom: 20px;
        /* Header text uses main text color */
        color: var(--tg-theme-text-color, var(--original-text-color));
      }

      .input-group {
        margin-bottom: 18px; /* Adjusted for new fields */
      }

      label {
        display: block;
        margin-bottom: 8px;
        /* Use Telegram hint color for labels */
        color: var(--tg-theme-hint-color, var(--original-label-color));
        font-size: 14px;
        font-weight: 500; /* Slightly bolder label */
      }

      .hint {
        color: var(--tg-theme-hint-color, #666);
        font-size: 12px;
        margin-top: -4px; /* Adjusted based on label margin */
        margin-bottom: 8px;
        line-height: 1.4;
      }

      input[type="tel"],
      input[type="text"],
      textarea {
        width: 100%;
        padding: 12px;
        /* Use hint color for border, match container bg */
        border: 1px solid var(--tg-theme-hint-color, var(--original-border-color));
        background-color: var(--tg-theme-secondary-bg-color, var(--original-white)); /* Match container or use bg_color? secondary seems better */
        color: var(--tg-theme-text-color, var(--original-text-color)); /* Input text color */
        border-radius: 8px;
        font-size: 16px;
        box-sizing: border-box;
        font-family: inherit;
        transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
      }

      input[type="tel"]:focus,
      input[type="text"]:focus,
      textarea:focus {
        border-color: var(--tg-theme-button-color, var(--original-primary-color));
        /* Optional: add a subtle shadow on focus */
        box-shadow: 0 0 0 2px var(--tg-theme-button-color-alpha, rgba(36, 129, 215, 0.2)); 
      }

      /* Style placeholder text */
      input[type="tel"]::placeholder,
      input[type="text"]::placeholder,
      textarea::placeholder {
        color: var(--tg-theme-hint-color, #999); /* Use hint color for placeholder */
        opacity: 1; /* Override default lighter opacity */
      }

      textarea {
        min-height: 80px; /* Can be overridden by inline style if needed */
        resize: vertical;
      }

      .accessory-buttons {
        margin-top: 10px;
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }

      .accessory-buttons button.accessory-btn {
        padding: 6px 10px;
        font-size: 13px;
        background-color: var(--tg-theme-secondary-bg-color, var(--original-secondary-color));
        color: var(--tg-theme-link-color, var(--original-primary-color));
        border: 1px solid var(--tg-theme-hint-color, var(--original-border-color));
        border-radius: 6px;
        cursor: pointer;
        transition: background-color 0.2s, color 0.2s, border-color 0.2s;
      }

      .accessory-buttons button.accessory-btn:hover {
        border-color: var(--tg-theme-link-color, var(--original-primary-color));
        background-color: var(--tg-theme-bg-color, var(--original-background-color));
      }

      .accessory-buttons button.accessory-btn:active {
        opacity: 0.7;
        background-color: var(--tg-theme-hint-color, #ccc); 
      }

      .button-group {
        display: flex;
        gap: 10px;
        margin-top: 25px; /* Increased space above main buttons */
      }

      button { /* This targets .cancel-btn and .send-btn in .button-group */
        flex: 1;
        padding: 12px;
        border: none;
        border-radius: 8px;
        font-weight: 500;
        font-size: 16px;
        cursor: pointer;
        transition: opacity 0.2s;
      }

      /* Specific styles for main action buttons, if needed, can be derived or kept as is */
      /* For example, if you want to ensure button:active here doesn't conflict with accessory-btn:active */
      .button-group button:active {
        opacity: 0.7;
      }

      .cancel-btn {
        background-color: var(--tg-theme-secondary-bg-color, var(--original-secondary-color));
        color: var(--tg-theme-text-color, var(--original-text-color));
        border: 1px solid var(--tg-theme-hint-color, transparent); /* Subtle border or none */
      }
      .cancel-btn:hover {
          opacity: 0.8;
      }

      .send-btn {
        background-color: var(--tg-theme-button-color, var(--original-primary-color));
        color: var(--tg-theme-button-text-color, var(--original-white));
      }
      .send-btn:hover {
          opacity: 0.85;
      }

      .error-message {
        color: var(--tg-theme-destructive-text-color, var(--original-destructive-color));
        font-size: 14px;
        margin-top: 15px;
        text-align: center;
      }

    </style>
  </head>
  <body>
    <div class="ticket-container">
      <div class="header">‚ûï –ù–æ–≤–∞—è –ó–∞—è–≤–∫–∞</div>

      <div class="input-group">
        <label for="phone">üìû –¢–µ–ª–µ—Ñ–æ–Ω –ö–ª–∏–µ–Ω—Ç–∞</label>
        <input
            type="tel"
            id="phone"
            inputmode="tel"
            placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞"
            enterkeyhint="next"
            aria-label="–¢–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–µ–Ω—Ç–∞"
            >
      </div>

        <div class="input-group">
          <label for="deviceModel">‚öôÔ∏è –ú–æ–¥–µ–ª—å –¢–µ—Ö–Ω–∏–∫–∏</label>
          <input
              type="text"
              id="deviceModel"
              placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Lenovo IdeaPad 5"
              inputmode="text"
              enterkeyhint="next"
              autocapitalize="sentences"
              aria-label="–ú–æ–¥–µ–ª—å —Ç–µ—Ö–Ω–∏–∫–∏"
              >
        </div>

        <div class="input-group">
          <label for="issueDescription">üõ†Ô∏è –•–∞—Ä–∞–∫—Ç–µ—Ä –ù–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–∏</label>
          <textarea
              id="issueDescription"
              placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ù–µ –∑–∞—Ä—è–∂–∞–µ—Ç—Å—è, —Ä–∞–∑–±–∏—Ç —ç–∫—Ä–∞–Ω"
              inputmode="text"
              enterkeyhint="next"
              autocapitalize="sentences"
              spellcheck="true"
              data-gramm="false"
              aria-label="–•–∞—Ä–∞–∫—Ç–µ—Ä –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–∏"
              style="height: 80px;" 
              ></textarea> 
        </div>

        <div class="input-group">
          <label for="accessories">üîå –ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è</label>
          <input
              type="text"
              id="accessories"
              placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ë–ª–æ–∫ –ø–∏—Ç–∞–Ω–∏—è, —Å—É–º–∫–∞"
              inputmode="text"
              enterkeyhint="done"
              autocapitalize="sentences"
              aria-label="–ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è"
              >
          <div class="accessory-buttons" style="margin-top: 8px; display: flex; gap: 8px; flex-wrap: wrap;">
            <button type="button" class="accessory-btn" onclick="addAccessory('–ë–ü')">+–ë–ü</button>
            <button type="button" class="accessory-btn" onclick="addAccessory('–°—É–º–∫–∞')">+–°—É–º–∫–∞</button>
            <button type="button" class="accessory-btn" onclick="addAccessory('–ö–∞–±–µ–ª—å')">+–ö–∞–±–µ–ª—å</button>
            <button type="button" class="accessory-btn" onclick="addAccessory('–ú—ã—à—å')">+–ú—ã—à—å</button>
            </div>
        </div>

        <div class="button-group">
          <button class="cancel-btn" onclick="goBack()" aria-label="–û—Ç–º–µ–Ω–∞">–û—Ç–º–µ–Ω–∞</button>
          <button class="send-btn" onclick="sendData()" aria-label="–û—Ç–ø—Ä–∞–≤–∏—Ç—å">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>

        <div id="error-message" class="error-message"></div>
    </div>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
      // Initialize Telegram Web App interactions
      if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
        Telegram.WebApp.ready(); // Signal that the app is ready

        // Optional: Adjust header color if available and needed
        // Telegram.WebApp.setHeaderColor(Telegram.WebApp.themeParams.secondary_bg_color || '#ffffff');

        // Optional: Listen for theme changes dynamically if needed
        // Although CSS variables update automatically, you might want to react in JS
        Telegram.WebApp.onEvent('themeChanged', function() {
          // Example: You could re-apply styles via JS if needed,
          // but usually just using CSS variables is sufficient.
          console.log('Theme changed:', Telegram.WebApp.themeParams);
          // Maybe adjust something not purely CSS-driven
        });
      }


      // --- Rest of your JavaScript (validation, sendData, goBack) remains the same ---

      function validatePhone(phone) {
        const trimmedPhone = phone.trim(); // Trim whitespace just in case

        if (trimmedPhone === '') {
            return { isValid: false, message: '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞.' };
        }

        // Regex Explained:
        // ^       - Anchor to the start of the string
        // (       - Start of group 1
        //   8     - Match the digit 8 literally
        //   \d{10} - Match exactly 10 digits (0-9)
        // )       - End of group 1
        // |       - OR
        // (       - Start of group 2
        //   \+7   - Match the characters +7 literally (\+ escapes the special '+' meaning)
        //   \d{10} - Match exactly 10 digits (0-9)
        // )       - End of group 2
        // $       - Anchor to the end of the string
        // This ensures the entire string matches *only* one of these two patterns.
        const specificFormatRegex = /^(8\d{10}|\+7\d{10})$/;

        if (specificFormatRegex.test(trimmedPhone)) {
            // The phone number matches either 8XXXXXXXXXX or +7XXXXXXXXXX format
            return { isValid: true, message: '' };
        } else {
            // The phone number does not match the required format
            return { isValid: false, message: '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç. –ù–æ–º–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∏–¥–∞ 8XXXXXXXXXX –∏–ª–∏ +7XXXXXXXXXX (–±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤ –∏ –¥–µ—Ñ–∏—Å–æ–≤).' };
        }
      }


      function validateDescription(description) {
        return description.trim() !== '';
      }

      function sendData() {
        const phoneInput = document.getElementById('phone');
        const descriptionInput = document.getElementById('description');
        const errorMessage = document.getElementById('error-message');

        const phone = phoneInput.value;
        const description = descriptionInput.value;

        errorMessage.textContent = ''; // Clear previous errors

        // Validate Phone using the new strict function
        const phoneValidationResult = validatePhone(phone);
        if (!phoneValidationResult.isValid) {
            errorMessage.textContent = phoneValidationResult.message;
            phoneInput.focus(); // Optional: Focus the input field with the error
            return;
        }

        // Validate Description
        if (!validateDescription(description)) {
            errorMessage.textContent = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã.';
            descriptionInput.focus(); // Optional: Focus the input field
            return;
        }

        // Check if Telegram Web App is available (keep this check)
        if (typeof Telegram === 'undefined' || !Telegram.WebApp) {
            errorMessage.textContent = '–í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Telegram –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ.';
            return;
        }

        // Prepare and send data (keep this part)
        const data = {
            phone: phone, // Send the original input value
            description: description,
            app_origin: 'ticket_app'
        };
        Telegram.WebApp.sendData(JSON.stringify(data));
        Telegram.WebApp.close();
      }

      function goBack() {
        if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
          Telegram.WebApp.close();
        } else {
          // Provide a fallback for non-Telegram environments
          try {
            window.history.back();
          } catch (e) {
            console.error("Cannot go back:", e);
            // Maybe disable the button or show a message if history.back fails
          }
        }
      }

      // Optional: Tell Telegram the main button is visible and clickable
      // Do this only if the 'Send' button should act like the main bot button
      // if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
      //     Telegram.WebApp.MainButton.setText('–û—Ç–ø—Ä–∞–≤–∏—Ç—å');
      //     Telegram.WebApp.MainButton.textColor = Telegram.WebApp.themeParams.button_text_color || '#ffffff';
      //     Telegram.WebApp.MainButton.color = Telegram.WebApp.themeParams.button_color || '#2481d7';
      //     Telegram.WebApp.MainButton.show();
      //     Telegram.WebApp.MainButton.onClick(sendData);
      //     // If using the MainButton, you might hide your .send-btn
      //     // document.querySelector('.send-btn').style.display = 'none';
      //     // You might also need to adjust the .cancel-btn width if .send-btn is hidden
      // }

    </script>
  </body>
</html>


